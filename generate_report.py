from jinja2 import Environment, FileSystemLoader
import pdfkit
from pymongo import MongoClient

# MongoDB connection string
client = MongoClient('mongodb+srv://yoelyy:Fafi12@cluster1.suarw8b.mongodb.net/?retryWrites=true&w=majority&tls=true&tlsAllowInvalidCertificates=true')
db = client.vulnerability_management
scans_collection = db.scans

env = Environment(loader=FileSystemLoader('templates'))
template = env.get_template('report_template.html')

def generate_report(scan_id):
    scan_data = scans_collection.find_one({"scan_id": scan_id})
    if scan_data:
        report_html = template.render(scan=scan_data)
        pdfkit.from_string(report_html, f'report_{scan_id}.pdf')
        print(f"Report generated: report_{scan_id}.pdf")
    else:
        print(f"No scan found with ID: {scan_id}")

if __name__ == "__main__":
    scan_id_to_generate = 11  # Replace with the actual scan ID you want to generate a report for
    generate_report(scan_id_to_generate)
